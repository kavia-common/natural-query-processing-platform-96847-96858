{"is_source_file": true, "format": "Python", "description": "This Python script initializes and migrates a SQLite database for the 'dsp_db' project. It creates necessary tables and indexes, performs idempotent migrations, and writes configuration files for backend consumption and visualization tools.", "external_files": ["sqlite3", "os", "sys", "typing"], "external_methods": ["sqlite3.connect", "os.getcwd", "os.path.exists", "os.makedirs", "open", "sys.exit", "subprocess.run"], "published": ["main"], "classes": [], "methods": [{"name": "None _enable_foreign_keys(conn: sqlite3.Connection)", "description": "Enables foreign key constraints for a SQLite connection.", "scope": "", "scopeKind": ""}, {"name": "bool _table_exists(cursor: sqlite3.Cursor, table_name: str)", "description": "Checks if a specific table exists in the database.", "scope": "", "scopeKind": ""}, {"name": "bool _column_exists(cursor: sqlite3.Cursor, table: str, column: str)", "description": "Checks if a specific column exists in a given table.", "scope": "", "scopeKind": ""}, {"name": "bool _index_exists(cursor: sqlite3.Cursor, index_name: str)", "description": "Checks if a specific index exists in the database.", "scope": "", "scopeKind": ""}, {"name": "None _create_base_schema(cursor: sqlite3.Cursor)", "description": "Creates the initial schema including 'app_info' and 'users' tables, and indexes.", "scope": "", "scopeKind": ""}, {"name": "None _migrate_existing_db(conn: sqlite3.Connection, cursor: sqlite3.Cursor)", "description": "Performs idempotent migrations, adding missing columns and indexes.", "scope": "", "scopeKind": ""}, {"name": "None _write_connection_info(db_file: str)", "description": "Writes database connection info to 'db_connection.txt'.", "scope": "", "scopeKind": ""}, {"name": "None _write_sqlite_env(db_path: str)", "description": "Creates 'db_visualizer/sqlite.env' with the database path for visualization purposes.", "scope": "", "scopeKind": ""}, {"name": "int main(db_file: Optional[str] = None)", "description": "Main entry point to initialize or migrate the SQLite database, including schema setup, writing config files, and reporting.", "scope": "", "scopeKind": ""}], "calls": ["sqlite3.connect", "cursor.execute", "conn.execute", "os.path.exists", "os.getcwd", "open", "os.makedirs", "subprocess.run", "sys.exit"], "search-terms": ["init_db", "SQLite", "database initialization", "schema migration", "app_info", "users table", "foreign keys", "idx_users_username", "idx_users_email"], "state": 2, "file_id": 4, "knowledge_revision": 20, "git_revision": "fdc53691a177f61789bf6ed386f63e0ca7d9461c", "revision_history": [{"17": "23ae6c491d930706bf0bdb5e107bf51961b595db"}, {"20": "fdc53691a177f61789bf6ed386f63e0ca7d9461c"}], "ctags": [{"_type": "tag", "name": "DB_NAME", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^DB_NAME = \"myapp.db\"  # Default DB file for this container$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_column_exists", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _column_exists(cursor: sqlite3.Cursor, table: str, column: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(cursor: sqlite3.Cursor, table: str, column: str)"}, {"_type": "tag", "name": "_create_base_schema", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _create_base_schema(cursor: sqlite3.Cursor) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(cursor: sqlite3.Cursor)"}, {"_type": "tag", "name": "_enable_foreign_keys", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _enable_foreign_keys(conn: sqlite3.Connection) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_index_exists", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _index_exists(cursor: sqlite3.Cursor, index_name: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(cursor: sqlite3.Cursor, index_name: str)"}, {"_type": "tag", "name": "_migrate_existing_db", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _migrate_existing_db(conn: sqlite3.Connection, cursor: sqlite3.Cursor) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(conn: sqlite3.Connection, cursor: sqlite3.Cursor)"}, {"_type": "tag", "name": "_table_exists", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _table_exists(cursor: sqlite3.Cursor, table_name: str) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(cursor: sqlite3.Cursor, table_name: str)"}, {"_type": "tag", "name": "_write_connection_info", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _write_connection_info(db_file: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(db_file: str)"}, {"_type": "tag", "name": "_write_sqlite_env", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def _write_sqlite_env(db_path: str) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(db_path: str)"}, {"_type": "tag", "name": "db_file_override", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^    db_file_override = os.environ.get(\"SQLITE_DB\") or None$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "main", "path": "/home/kavia/workspace/code-generation/natural-query-processing-platform-96847-96858/dsp_db/init_db.py", "pattern": "/^def main(db_file: Optional[str] = None) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "(db_file: Optional[str] = None)"}], "hash": "c82dfccc71a1f8c535bbd85016eb8dc1", "format-version": 4, "code-base-name": "dsp_db", "filename": "dsp_db/init_db.py", "fields": [{"name": "DB_NAME = \"myapp.db\"  # Default DB file for this container", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "db_file_override = os.environ.get(\"SQLITE_DB\") or None", "scope": "", "scopeKind": "", "description": "unavailable"}]}